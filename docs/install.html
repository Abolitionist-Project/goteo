<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Goteo Developer&#039;s Documentation</title>

        <link rel="stylesheet" href="http://goteofoundation.github.io/goteo/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://goteofoundation.github.io/goteo/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://goteofoundation.github.io/goteo/css/main.css">
        <link rel="stylesheet" href="http://goteofoundation.github.io/goteo/css/goteo.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
        <link rel="stylesheet" href="http://goteofoundation.github.io/goteo/highlight/styles/monokai.css">

    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="http://goteofoundation.github.io/goteo/">
                Goteo Developer&#039;s Documentation
                <small class="hidden-xs hidden-sm">
                    An opensource crowdfunding platform made with PHP
                </small>
            </a>

                            <a href="https://github.com/goteofoundation/goteo">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                                                    <p class="text-muted">
                                Main documentation
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/index.html">
                                            About
                                        </a>
                                    </li>
                                                                    <li class="active">
                                        <a href="http://goteofoundation.github.io/goteo/docs/install.html">
                                            Install
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/upgrade.html">
                                            Upgrade
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/console.html">
                                            Console scripts
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Developers
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/environment.html">
                                            Environment
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/templates.html">
                                            Template system
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/migration.html">
                                            Legacy migration howto
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/payments.html">
                                            Payment process
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/extend.html">
                                            Plugins & extending
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/events.html">
                                            Using events
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/docs/developers/consoledev.html">
                                            Extending console
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                About
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/release_notes.html">
                                            Release notes
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="http://goteofoundation.github.io/goteo/LICENSE">
                                            License
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                
                <section class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1 id="installation">Installation</h1>
<p>This guide shows you how to install a standard copy of the Goteo code. To personalize your installation (changing views, etc) it's strongly recommended to create a plugin where views are overwritten. Otherwise any change you make to the code will be lost on software updates (or you will go throught a lot of pain updating the code).</p>
<p>Please referer to the &quot;<a href="http://goteofoundation.github.io/goteo/docs/developers/extend.html">extend section</a>&quot; to learn how to do that. </p>
<h2 id="server-requirements">Server requirements</h2>
<ul>
<li>PHP v5.6 (PHP 7 recommended) or later with extensions <code>gd</code>, <code>mcrypt</code>, <code>curl</code>, <code>mbstring</code>, <code>json</code>, <code>mysql</code> activated</li>
<li>Access to the terminal in the webserver and cron.</li>
<li>Apache, Nginx or any other server with ModRewrite activated</li>
<li>MySQL 5.7 (or MariaDB 10.2) or later</li>
</ul>
<blockquote>
<p>At this point, there are still no production-ready releases. Please refer to the <a href="developers/environment.html">developers</a> documentation for more info.</p>
<p>You will need to install dependencies and to build a <code>dist</code> production folder to point the webserver onto it.</p>
<p>We use <a href="https://getcomposer.org/">Composer</a> and <a href="http://gruntjs.com/">Grunt</a> for that. <a href="developers/environment.html">Be sure to have it installed in your system</a>.</p>
<p><strong>Quick start</strong></p>
<p>Install all the required dependencies:</p>
<pre><code class="language-bash">composer install
npm install</code></pre>
<p>Create and edit your confinguration:</p>
<pre><code class="language-bash">cp config/demo-settings.yml config/settings.yml</code></pre>
<p>Create the compiled minimized system:</p>
<pre><code class="language-bash">grunt build:dist</code></pre>
<p>Point your web server to handle all request by the file <code>goteo/dist/index.php</code></p>
<p>Alternatively, use  <code>grunt build:devel</code> for javascript/css debugging and point the webserver to <code>goteo/dist/index_dev.php</code></p>
</blockquote>
<h2 id="goteo-configuration">Goteo configuration</h2>
<p>You will need to create a new file in the folder <code>config</code> named <code>settings.yml</code></p>
<p>Use <code>demo-settings.yml</code> or <code>vagrant-settings.yml</code> as a example.</p>
<p>Particularly you must configure the <code>db:</code> section with the proper <strong>username/password</strong> for MySQL in the file <code>config/settings.yml</code></p>
<p>You can specify a different <code>dev-settings.yml</code> file which will be used by <code>public/index_dev.php</code></p>
<p>It is also possible to define a custom settings file with the env var <code>GOTEO_CONFIG_FILE</code>, ie:</p>
<pre><code class="language-bash">export GOTEO_CONFIG_FILE='/my/path/my-settings.yml'
grunt serve</code></pre>
<p>Example installation <code>config/settings.yml</code>:
You can overwrite any variable defined in <code>Resources/defaults.yml</code> in this file</p>
<pre><code class="language-yaml"># Goteo settings file
---

# Internal secret for hashes
secret: --a-very-secret-string---

# local enviroment: local, beta, real
env: local
debug: true # whether to show trace for errors or not
            # This is always true for local or beta env
# liveport: 35729 # Local development only livereload port (optional)

# Default system language
lang: es

# Default timezone
timezone: Europe/Madrid

# url
url:
    main: //example.com
    # static resources url if you use a different assets server
    assets: //example.com
    #optional, configure this as hostname only (ex: example.com) if you want languages to be selected as subdomains (es.example.com, en.example.com)
    url_lang: example.com

    # If you want to use a CDN or another web server to serve the cached images
    # You can define this constants. All cached images links will point to this
    # Url, event if don't exists yet.
    # Example:
    # Point a data.example.com to var/cache/images
    # the place a .htaccess in var/cache/images/.htaccess with this content
    # &lt;ifmodule mod_rewrite.c&gt;
    # RewriteEngine on
    # RewriteCond %{REQUEST_FILENAME} !-f
    # RewriteCond %{REQUEST_FILENAME} !-d
    # RewriteRule ^(.*) http://example.com/img/$1 [R=302,L]
    # &lt;/ifmodule&gt;
    #
    data:

# PLUGINS
# Extend is the directory to personalize your copy of goteo.org
# Routes, classes and templates can be overridden by copying the main structure
# ie:
#    - Autoloading classes
#    - Templates will be found first from extend/plugin-name/Resources/templates path
#    - Tests should be placed into extend/plugin-name/tests path
#    - Routes can be overwritten
#    - Service container can be tampered

plugins:
    goteo-dev:
        active: true # plugin should be active=true to be loaded

# Payment methods, must be registered as classes implementing Goteo\Payment\Method\PaymentMethodInterface
payments:
    # Paypal
    paypal:
        active: true
        testMode:  true # set to false to real checkouts
        username: paypal@example.com
        password: paypal-password
        signature: PAYPAL-Signature
        # brandName: Your organisation
        # headerImageUrl: Some URL image for the header
        # logoImageUrl: logo URL
        # borderColor: B5DADC

    # This is a built-in payment method using internal credit
    # Comissions can be configured here if needed
    pool:
        active: true
    # A stupid payment method defined in the plugin goteo-dev
    # Useful for development and testing
    dummy:
        active: true

    # Additional custom payment methods should be added here

# Force using https protocol
ssl: false

# IMPORTANT! if ssl is true and your server is behind a proxy
# List the trusted proxies for SSL connection here
proxies:
    - 127.0.0.1
    # Cloudflare IP list:
    # - 103.21.244.0/22
    # - 103.22.200.0/22
    # - 103.31.4.0/22
    # - 104.16.0.0/12
    # - 108.162.192.0/18
    # - 141.101.64.0/18
    # - 162.158.0.0/15
    # - 172.64.0.0/13
    # - 173.245.48.0/20
    # - 188.114.96.0/20
    # - 190.93.240.0/20
    # - 197.234.240.0/22
    # - 198.41.128.0/17
    # - 199.27.128.0/21

# Default commission fee
fee: 4

# Filesystem used by goteo
filesystem:
    handler:    local      # 's3' to use AmazonS3 storage, 'local' to use local file system
    # Only need to be defined credentials if file system is s3:
    # AWS credentials
    aws: &amp;aws1
        key:        your-aws-key
        secret:     your-aws-secret
        region:     eu-west-1

    bucket:
        static:     static.example.com        # where to store the assets (css, js, images)
        mail:       mail-archive.example.com  # where to store alternative mail view

# Database stuff
db:
    driver:   mysql     # Database driver (mysql)
    host:     localhost # Database host
    port:     3306      # Database port
    charset:  utf8mb4     # Database charset
    database: your_goteo_db     # Database schema (database name)
    username: your_user     # Database user for the goteo database
    password: your_password  # Password for the goteo database

# HTML Metas
meta:
    title:       --meta-title--       # Html default &lt;title&gt;
    description: --meta-description-- # Html default &lt;meta description&gt;
    keywords:    --keywords--         # Html default &lt;meta keywords&gt;
    author:      --author--           # Html default &lt;meta author&gt;
    copyright:   --copyright--        # Html default &lt;meta copyright&gt;

# Mail transport
mail:
    # receiving emails
    mail:         info@example.com     # Main
    contact:      info@example.com     # consulting head
    manager:      manager@example.com  # accounts manager
    fail:         dev@example.com      # dev head
    log:          sitelog@example.com  # Loggin mail

    # allowed addresses while in BETA/LOCAL env in PREG format
    beta_senders: "(.+)example\\.org|(.+)example\\.com"

    # Default users where to send project notifications by default
    # Only used if no consultants are assigned
    consultants:
        root: 'Root'

    transport:
        from:          noreply@example.com
        name:          Goteo Sender
        type:          smtp
        # if type is smtp:
        smtp:
            auth:     true
            secure:   ssl
            host:     smtp.example.com
            port:     587
            username: smtp-usermail
            password: smtp-password

    quota:
        total: 50000  # Maximum sending quota in 24 hours time (useful for SMTP servers like Amazon SES)
        sender: 40000 # Part of this quota used by newsletter mailing

    # Amazon SNS key to process automatic bounces: 'arn:aws:sns:us-east-1:XXXXXXXXX:amazon-ses-bounces'
    # URL mus be: goteo_url.tld/aws-sns.php
    sns:
        client_id:        XXXXXXXXX
        region:           us-east-1
        bounces_topic:    amazon-ses-bounces
        complaints_topic: amazon-ses-complaints

# This will be used for geolocating users, projects, and mail tracking
geolocation:
    # Path to maxmind databases, you need to download (and keep updated) either the free o commercial
    # databases from maxmind. Check this for more info: https://dev.maxmind.com/geoip/geoipupdate/
    # relative paths are allowed (ie: you can save your maxmind databases into config/resources/maxmind if you want)
    # Un comment next 2 lines if you have it installed and working:
    # maxmind:
    #    cities: /usr/share/GeoIP/GeoLite2-City.mmdb
    google_maps_key: # Google Maps Key
                     # Ge one here: https://developers.google.com/maps/documentation/javascript/get-api-key

# Social Login Services
# Fill an uncomment the needed one's
oauth:
    # Credentials app Facebook
    facebook:
       active: false
       id:     000000000000000                  #
       secret: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa #

    # Credentials app Twitter
    twitter:
       active: false
       id:      aaaaaaaaaaaaaaaaaaaaaa                     #
       secret:  aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa #

    # Credentials app Linkedin
    linkedin:
       active: false
       id:     aaaaaaaaaaaa     #
       secret: aaaaaaaaaaaaaaaa #

    # Credentials Google
    google:
       active: false
       id: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
       secret: aaaaaaaaaaaaaaaaaa

    # OpenID logins does not need for Keys, just active/inactive
    yahoo:
        active: false

    openid:
        active: true

# Optional analytics ID's
# Example:
# google: UA-0000000-01
analytics:
    google:
</code></pre>
<h2 id="database-install">Database install</h2>
<p>First you'll need an empty database and have your <code>config/settings.yml</code> file with the section <strong>db</strong> properly configured with your database parameters.</p>
<p>Once you got it, install the database schema and a minimal data set is easy: In a terminal, in the root directory where Goteo code is, run the command <code>migrate</code>:</p>
<pre><code class="language-bash">php bin/console migrate install</code></pre>
<p>This should give you an empty system with only one user &quot;root&quot;.</p>
<p>Login with user <strong>&quot;root&quot;</strong> and password <strong>&quot;root&quot;</strong> (no quotes).
Go <code>http://your.intallation.site/admin/users/edit/root</code> to change the password and email
Try login with that password and manage the contents at <a href="http://your.intallation.site/admin">http://your.intallation.site/admin</a></p>
<p>The install script also creates demo project, you can remove all demo data by using the command <code>./bin/console dev:statusinit --erase'</code> from the <a href="developers/extend.html#dev-plugin">dev-plugin</a>.</p>
<h2 id="cron-configuration">Cron configuration</h2>
<p>You will need to add a cron/crontab line in order to process severals project related events:</p>
<pre><code class="language-cron">* * * * *   nice /usr/bin/php /path/to/installation/bin/console cron --lock --logmail &gt; /dev/null 2&gt;&amp;1</code></pre>
<p>Refer to the <strong>Console scripts</strong> documentation for more info</p>
<h2 id="server-configuration">Server configuration</h2>
<p>Goteo has been tested under Nginx and Apache configurations.</p>
<h3 id="apache-config">Apache config:</h3>
<p>Modrewrite must be enabled for apache below 2.2.16:</p>
<pre><code class="language-apache">&lt;IfModule mod_rewrite.c&gt;
    Options -MultiViews

    RewriteEngine On
    #RewriteBase /path/to/goteo-folder/dist
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [QSA,L]
&lt;/IfModule&gt;</code></pre>
<p>Alternatively, if you use Apache 2.2.16 or higher, you can use the FallbackResource directive to make your .htaccess even easier:</p>
<pre><code class="language-apache">FallbackResource /index.php</code></pre>
<blockquote>
<p><strong>NOTE:</strong></p>
<ul>
<li>If you want to debug the site, you must point the server to the <code>index_dev.php</code> file instead of <code>index.php</code>. This way error traces will be shown in the error pages</li>
<li>If you cannot configure the server to point to the <code>dist/</code> folder, the <code>.htaccess</code> file on the root folder can be used as alternative (using this solution will force the use of the URL assets to point to the dist/ folder.)</li>
</ul>
</blockquote>
<h3 id="apache-24-config-demo">Apache 2.4 config demo:</h3>
<pre><code class="language-apach2">&lt;VirtualHost *:80&gt;
    ServerName domain.tld

    ServerAdmin webmaster@localhost
    DocumentRoot /path/to/my/goteo-folder/dist

    # Custom settings for apache
    SetEnv GOTEO_CONFIG_FILE /path/to/my/settings.yml

    FallbackResource /index.php

    &lt;Directory /path/to/my/goteo-folder/dist&gt;
        Options Indexes FollowSymlinks
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;

    #LogLevel info ssl:warn

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

&lt;/VirtualHost&gt;</code></pre>
<h3 id="nginx-config-demo">Nginx config demo:</h3>
<pre><code class="language-nginx">server {
    server_name domain.tld www.domain.tld;
    root /path/to/my/goteo-folder/dist;

    location / {
        # try to serve file directly, fallback to front controller
        try_files $uri /index.php$is_args$args;
    }

    # If you have 2 front controllers for dev|prod use the following line instead
    # location ~ ^/(index|index_dev)\.php(/|$) {
    location ~ ^/index\.php(/|$) {
        # the ubuntu default
        fastcgi_pass   unix:/var/run/php/php7.0-fpm.sock;
        # for running on centos
        #fastcgi_pass   unix:/var/run/php-fpm/www.sock;

        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param HTTPS off;

        # Prevents URIs that include the front controller. This will 404:
        # http://domain.tld/index.php/some-path
        # Enable the internal directive to disable URIs like this
        # internal;
    }

    #return 404 for all php files as we do have a front controller
    location ~ \.php$ {
        return 404;
    }

    error_log /var/log/nginx/project_error.log;
    access_log /var/log/nginx/project_access.log;
}</code></pre>
                </section>

            </div>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="http://goteofoundation.github.io/goteo/highlight/highlight.pack.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
